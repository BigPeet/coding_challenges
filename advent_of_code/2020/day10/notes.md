The first part should be easily solvable by sorting the list first.

The solution for the first part is 2590.

Part two seems more difficult. If there are trillions of options, it would be unwise to just test all of them.

My first idea is to use the differences of 3 as hard separators.
These connections HAVE to be selected and separate the whole chain into smaller chunks.
For each chunk the possible valid combinations can be calculated, then multiply the results of all chunks to get the number of all possibile combinations.
