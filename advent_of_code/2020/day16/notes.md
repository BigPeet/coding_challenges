The solution for the first part is 22000.

My idea for the second part is as follows:
* Track which positions (1st, 2nd, ...) are valid for each ticket field (e.g. "class").
* If there is a ticket field with only a single position, that has to take it.
    * Lock that one in and remove the position from the list of candidates for all other fields.
* Hope there is no ambiguous scenario...

The solution for the second part is 410460648673.
