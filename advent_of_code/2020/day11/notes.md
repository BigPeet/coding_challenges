This is basically a cellular automaton.

Solution for the first part is 2254.
Solution for the second part is 2004.
